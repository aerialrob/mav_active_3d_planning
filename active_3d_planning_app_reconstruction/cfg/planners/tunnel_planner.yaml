# General parameters for the planner node
replan_pos_threshold: 0.15
replan_yaw_threshold: 0.15

max_new_segments: 0
min_new_segments: 0
max_new_tries: 0
min_new_tries: 0
min_new_value: 0
expand_batch : 10
manual: false
wp_file: "/home/bianca.bendris/a4r_emb/src/a4r_embedded/mav_active_3d_planning/active_3d_planning_app_reconstruction/cfg/planners/forward_backward_2_heights.txt"

# Verbosity and visualization
verbose: true
verbose_modules: true
build_modules_on_init: true
visualize_gain: true
visualize: true
highlight_executed_trajectory: true

# Logging
log_performance: true
performance_log_dir: "/home/bianca.bendris/a4r_emb/"

# Specify a map representation
map:
  type: "VoxbloxMap"

# System constraints
system_constraints:
  v_max: 1.0
  a_max: 1.0
  yaw_rate_max: 1.6
  yaw_accel_max: 1.6
  collision_radius: 1.0

# Specifying a trajectory generator
trajectory_generator:
  collision_optimistic: false
  bounding_volume_args: "/local_bounding_volume"
  clearing_radius: 0.0

  # type: "RRTStar"
  # all_semgents_feasible: true
  # crop_segments: false
  # crop_margin: 0.3
  # crop_min_length: 1.0
  # max_extension_range: 2.0
  # maximum_tries: 100
  # sampling_rate: 20.0
  # sample_yaw: false
  # sampling_mode: "semilocal"
  # semilocal_sampling_count: 10
  # semilocal_sampling_radius_max: 10
  # semilocal_sampling_radius_min: 1.5
  # rewire_root: false
  # rewire_intermediate: true
  # reinsert_root: true
  # max_rewire_range: 1.6
  # max_density_range: 0.0
  # n_neighbors: 20

  type: "FeasibleInformedRRTStar"
  all_segments_feasible: false
  #num_samples: 1
  sampling_rate: 20.0
  max_sample_dist: 3.0
  min_sample_dist: 1.0
  rewire: true
  rewire_update: true
  rewire_root: true
  reinsert_root: true
  n_neighbors: 50
  yaw_range: 0.5235 #30 deg
  maximum_tries: 50
  goal_x: 0.0
  goal_y: 50.0
  goal_z: 1.5
  prob_divisions: 30.0
  apply_prob_dist: true
  prob_weight: 0.1
  tunnel_width: 9.0
  find_wall_direction: true

  # Generator Update step
  generator_updater:
   type: "RecheckCollision"


# trajectory_generator:
#   type: "Uniform"
#   collision_optimistic: false
#   bounding_volume_args: "/map_bounding_volume"

#   # Generator Params
#   n_segments: 5
#   distance: 1.5
#   yaw_angle: 1.2
#   ascent_angle: 0.523
#   sampling_rate: 20
#   goal_oriented: true
#   goal_position_x: 0.0
#   goal_position_y: 50.0
#   goal_position_z: 1.5

#   # Expansion site selection policy
#   segment_selector:
#     type: "RandomWeighted"
#     revisit: false
#     factor: 2.0
#     leaf_probability: 1.0
#     uniform_probability: 0.2

#   # Generator Update step
#   generator_updater:
#     type: "RecheckCollision"



trajectory_evaluator:
  type: "VoxelWeightEvaluator"
  visualize_sensor_view: true
  accurate_frontiers: true
  surface_frontiers: true
  checking_distance: 2.0
  bounding_volume_args: "/target_bounding_volume"
  frontier_voxel_weight: 0.0
  new_voxel_weight: 0.0
  min_impact_factor: 0.01
  ray_angle_x: 0.000917 #orbbec-0.0017239 ids-0.000917 #0.002454
  ray_angle_y: 0.000990 #orbbec-0.0018017 ids-0.000990 #0.002681
  use_z_gain: true
  desired_voxel_distance: 1.5
  z_margin: 2.0
  close_voxel_gain: 1
  far_voxel_gain: 0
  #Expansion site selection policy
  
  # Evaluator params and sensor model for simulated sensor evaluators
  clear_from_parents: false
  camera_params_ns: "/unreal/unreal_ros_client/camera_params"
  visualize_sensor_view: true
  bounding_volume_args: "/target_bounding_volume"
  sensor_model:
    type: "IterativeRayCaster"
    sampling_time: 0.5
    ray_length: 3.0
    num_sensors: 3
    downsampling_factor: 1
    # First sensors characteristics
    focal_length_0: 889 #orbbec-520
    resolution_x_0: 1600 #orbbec-640
    resolution_y_0: 1200 #orbbec-480
    mounting_translation_x_0: 0.05
    mounting_translation_y_0: 0.0
    mounting_translation_z_0: 0.3
    mounting_rotation_y_0: -0.7071 # -0.5 # #-0.2588
    mounting_rotation_w_0: 0.7071 #  0.866 #0.9659
    # Second sensors characteristics
    focal_length_1: 889 #orbbec-520
    resolution_x_1: 1600 #orbbec-640
    resolution_y_1: 1200 #orbbec-480
    mounting_translation_x_1: 0.0
    mounting_translation_y_1: 0.05
    mounting_translation_z_1: 0.3
    mounting_rotation_z_1: 0.7071
    mounting_rotation_w_1: 0.7071
    # Third sensor characteristics
    focal_length_2: 889 #orbbec-520
    resolution_x_2: 1600 #orbbec-640
    resolution_y_2: 1200 #orbbec-480
    mounting_translation_x_2: 0.0
    mounting_translation_y_2: -0.05
    mounting_translation_z_1: 0.3
    mounting_rotation_z_2: -0.7071
    mounting_rotation_w_2: 0.7071
  # Choose a cost
  cost_computer:
    type: "SegmentTime"
    penalize_altitude_change: false
    penalize_yaw_change: false
    penalize_distance_to_goal: true
    accumulate: false
    time_weight: 5.0
    time_limit: 10
    exp_mult: 100
    exp_div: 5
    # How to compute the values
  value_computer:
    type: "LinearValue"
    # following_value_computer:
    #   type: "RelativeGain"
    cost_weight: 1
    gain_weight: 1
  # Execution policy for available segments
  next_selector:
    type: "SubsequentBest"
  # Evaluator Update step
  evaluator_updater:
    type: "UpdateAll"
    update_gain: true
    update_cost: false
    update_value: true
# Secify a backtracker if the planner gets stuck
back_tracker:
  type: "RotateReverse"
  turn_rate: 1.6
  update_rate: 2.0
  sampling_rate: 20.0
  n_rotations: 1
  stack_size: 10
